{% extends "base.html" %} {% block content %}
<nav class="navbar navbar-expand-lg navbar-nav">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('home') }}">Kitaab</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon color-toggle"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
        <li class="nav-item m-2">
          <a
            class="nav-link active border rounded form-control text-center"
            href="{{ url_for('borrowings') }}"
            >Go Back</a
          >
        </li>
      </ul>

      <form class="d-flex m-2" action="{{ url_for('home') }}" method="post">
        <button class="btn btn-outline-danger form-control" type="submit">
          Logout
        </button>
      </form>
    </div>
  </div>
</nav>
<div class="text-center">
  <div>
    <canvas id="pdfCanvas" style="height: 85vh"></canvas>
  </div>
  <div>
    <button class="btn active border rounded text-center m-1" id="prevPageBtn">Previous Page</button>
    <button class="btn active border rounded text-center m-1" id="nextPageBtn">Next Page</button>
  </div>
</div>

<script>
  let currentPage = 1;
  let pdfDoc = null;

  // Function to render a page
  function renderPage(pageNumber) {
    pdfDoc
      .getPage(pageNumber)
      .then((page) => {
        // Set up the canvas
        const canvas = document.getElementById("pdfCanvas");
        const context = canvas.getContext("2d");
        const viewport = page.getViewport({ scale: 1.5 });

        // Set the canvas size to the PDF page size
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        // Render the PDF page on the canvas
        const renderContext = {
          canvasContext: context,
          viewport: viewport,
        };
        page.render(renderContext);
      })
      .catch((error) => {
        console.error("Error rendering page:", error);
      });
  }

  // Function to load PDF and render first page
  function loadPdfAndRender(pdfUrl) {
    pdfjsLib
      .getDocument(pdfUrl)
      .promise.then((doc) => {
        pdfDoc = doc;
        renderPage(currentPage);
      })
      .catch((error) => {
        console.error("Error loading PDF:", error);
      });
  }

  // Handle button clicks to navigate pages
  document.getElementById("prevPageBtn").addEventListener("click", () => {
    if (currentPage > 1) {
      currentPage--;
      renderPage(currentPage);
    }
  });

  document.getElementById("nextPageBtn").addEventListener("click", () => {
    if (pdfDoc && currentPage < pdfDoc.numPages) {
      currentPage++;
      renderPage(currentPage);
    }
  });

  // Load PDF document
  const pdfUrl =
    "{{ url_for('static', filename='uploads/content/'+ book.content) }}";
  loadPdfAndRender(pdfUrl);
</script>
{% endblock %}
